# azure-pipelines.yml

trigger:
- master

parameters:
  - name: runExtraStep
    type: boolean
    default: true

  - name: mavenGoals
    type: string
    default: clean test
    values:
      - clean test
      - not clean test

pool: Default

steps:
# Expose parameters as runtime variables

- task: octane-start-task-private@1
  condition: always()
  inputs:
    OctaneServiceConnection: 'octaneConnectionPrivate'
    WorkspaceList: '3006'
    CreatePipelineCheckbox: true

- script: |
    echo "Hello, $(name)!"
    echo "This is a regular script step."
    echo "Parameter value for runExtraStep: $(param_runExtraStep)"
    echo "Parameter value for mavenGoals: $(param_mavenGoals)"
  displayName: 'Say Hello'

- task: Maven@4
  inputs:
    mavenPomFile: 'pom.xml'
    goals: '${ parameters.mavenGoals }'
    publishJUnitResults: true
    testResultsFiles: '**/surefire-reports/TEST-*.xml'
    javaHomeOption: 'JDKVersion'
    mavenVersionOption: 'Default'
    mavenAuthenticateFeed: false
    effectivePomSkip: false
    sonarQubeRunAnalysis: false
  continueOnError: true

# Optional step based on parameter
- ${{ if eq(parameters.runExtraStep, true) }}:
  - script: |
      echo "This extra step runs only if runExtraStep is true."
    displayName: 'Optional Extra Step'

- task: octane-end-task-private@1
  condition: always()
  inputs:
    OctaneServiceConnection: 'octaneConnectionPrivate'
    WorkspaceList: '3006'
